<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ezzat - Embedded Systems Visionary</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Corrected Links for Drei, Fiber, and Framer Motion -->
    <script src="https://unpkg.com/@react-three/fiber@7.0.27/dist/react-three-fiber.umd.js"></script>
    <script src="https://unpkg.com/@react-three/drei@7.29.0/dist/react-three-drei.umd.js"></script>
    <script src="https://unpkg.com/framer-motion@6.5.3/dist/framer-motion.umd.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, Suspense } = React;
        const { Canvas, useFrame, useThree } = window.ReactThreeFiber;
        const { Html, OrbitControls, useLoader, useProgress } = window.Drei;
        const { TextureLoader, Vector3, BufferGeometry, LineDashedMaterial, MeshStandardMaterial, PlaneGeometry, BoxGeometry, SphereGeometry } = THREE;

        // Utility functions
        const lerp = (a, b, t) => a + (b - a) * t;
        const clamp = (value, min, max) => Math.min(Math.max(value, min), max);

        // Custom hooks
        const useMousePosition = () => {
            const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });

            useEffect(() => {
                const updateMousePosition = ev => {
                    setMousePosition({ x: ev.clientX, y: ev.clientY });
                };

                window.addEventListener('mousemove', updateMousePosition);

                return () => {
                    window.removeEventListener('mousemove', updateMousePosition);
                };
            }, []);

            return mousePosition;
        };

        // 3D Components
        const CircuitBoard = () => {
            const mesh = useRef();
            const texture = useLoader(TextureLoader, '/circuit-texture.jpg');

            useFrame((state) => {
                mesh.current.rotation.x = Math.sin(state.clock.elapsedTime) * 0.2;
                mesh.current.rotation.y = Math.sin(state.clock.elapsedTime) * 0.1;
            });

            return (
                <mesh ref={mesh} position={[0, 0, -5]}>
                    <planeGeometry args={[10, 10]} />
                    <meshStandardMaterial map={texture} />
                </mesh>
            );
        };

        const FloatingChip = ({ position }) => {
            const mesh = useRef();
            const [hovered, setHovered] = useState(false);

            useFrame((state) => {
                mesh.current.position.y = position[1] + Math.sin(state.clock.elapsedTime) * 0.1;
                mesh.current.rotation.x = Math.sin(state.clock.elapsedTime) * 0.2;
                mesh.current.rotation.z = Math.cos(state.clock.elapsedTime) * 0.2;
            });

            return (
                <mesh
                    ref={mesh}
                    position={position}
                    onPointerOver={() => setHovered(true)}
                    onPointerOut={() => setHovered(false)}
                >
                    <boxGeometry args={[0.5, 0.5, 0.1]} />
                    <meshStandardMaterial color={hovered ? 'hotpink' : 'orange'} />
                    <Html distanceFactor={10}>
                        <div className="bg-white p-2 rounded shadow-lg">
                            <h3 className="text-sm font-bold">Microchip</h3>
                            <p className="text-xs">ARM Cortex-M4</p>
                        </div>
                    </Html>
                </mesh>
            );
        };

        const ConnectingLines = () => {
            const lines = useRef();

            useFrame(() => {
                lines.current.children.forEach((line) => {
                    line.material.uniforms.dashOffset.value -= 0.01;
                });
            });

            return (
                <group ref={lines}>
                    <Line start={[-2, 0, 0]} end={[2, 0, 0]} />
                    <Line start={[0, -2, 0]} end={[0, 2, 0]} />
                    <Line start={[-1, -1, 0]} end={[1, 1, 0]} />
                </group>
            );
        };

        const Line = ({ start, end }) => {
            const ref = useRef();

            useEffect(() => {
                const geometry = new BufferGeometry().setFromPoints([
                    new Vector3(...start),
                    new Vector3(...end)
                ]);
                ref.current.geometry = geometry;
            }, [start, end]);

            return (
                <line ref={ref}>
                    <bufferGeometry />
                    <lineDashedMaterial color="cyan" dashSize={0.2} gapSize={0.1} />
                </line>
            );
        };

        // Main Components
        const Loader = () => {
            const { progress } = useProgress();
            return <Html center>{progress} % loaded</Html>;
        };

        const Scene = () => {
            return (
                <Canvas camera={{ position: [0, 0, 10], fov: 50 }}>
                    <OrbitControls enableZoom={false} />
                    <ambientLight intensity={0.5} />
                    <spotLight position={[10, 10, 10]} angle={0.15} penumbra={1} />
                    <pointLight position={[-10, -10, -10]} />
                    <Suspense fallback={<Loader />}>
                        <CircuitBoard />
                        <FloatingChip position={[-2, 0, 0]} />
                        <FloatingChip position={[2, 0, 0]} />
                        <FloatingChip position={[0, 2, 0]} />
                        <ConnectingLines />
                    </Suspense>
                </Canvas>
            );
        };

        const Header = () => {
            const mousePosition = useMousePosition();
            const [isScrolled, setIsScrolled] = useState(false);

            useEffect(() => {
                const handleScroll = () => {
                    setIsScrolled(window.scrollY > 50);
                };

                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            return (
                <motion.header
                    className={`fixed w-full z-50 transition-all duration-300 ${
                        isScrolled ? 'bg-white shadow-lg' : 'bg-transparent'
                    }`}
                    initial={{ y: -100 }}
                    animate={{ y: 0 }}
                    transition={{ type: 'spring', stiffness: 300, damping: 30 }}
                >
                    <nav className="container mx-auto px-6 py-4">
                        <ul className="flex justify-center space-x-8">
                            {['About', 'Skills', 'Projects', 'Experience', 'Contact'].map((item) => (
                                <motion.li
                                    key={item}
                                    className="relative"
                                    whileHover={{ scale: 1.1 }}
                                    style={{
                                        transform: `translate(${(mousePosition.x - window.innerWidth / 2) / 50}px, ${
                                            (mousePosition.y - window.innerHeight / 2) / 50
                                        }px)`,
                                    }}
                                >
                                    <a
                                        href={`#${item.toLowerCase()}`}
                                        className={`text-lg font-semibold ${
                                            isScrolled ? 'text-gray-800' : 'text-white'
                                        } hover:text-blue-500 transition-colors`}
                                    >
                                        {item}
                                    </a>
                                </motion.li>
                            ))}
                        </ul>
                    </nav>
                </motion.header>
            );
        };

        const Hero = () => {
            return (
                <section className="relative h-screen flex items-center justify-center overflow-hidden bg-gray-900">
                    <div className="relative z-10 text-center">
                        <h1 className="text-6xl font-bold text-white mb-4">John Doe</h1>
                        <p className="text-2xl text-gray-300 mb-8">Embedded Systems Visionary</p>
                        <a href="#contact" className="bg-blue-500 text-white px-8 py-3 rounded-full text-lg font-semibold hover:bg-blue-600 transition-colors">
                            Let's Connect
                        </a>
                    </div>
                </section>
            );
        };

        // Main App Component
        const App = () => {
            return (
                <div className="bg-gray-100 min-h-screen">
                    <Header />
                    <Hero />
                    <Scene />
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
